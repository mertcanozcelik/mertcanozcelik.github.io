<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeliÅŸmiÅŸ TRL Puanlama AracÄ± (MÃ¼hendislik & YazÄ±lÄ±m)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- SheetJS (xlsx) CDN for Excel export -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .progress-bar-inner {
            transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out;
        }
        /* BÃ¶lÃ¼m SeÃ§ici Buton Stilleri (GÃ¼ncellendi) */
        .section-selector button {
            background-color: #374151; /* gray-700 */
            color: #D1D5DB; /* gray-300 */
            font-size: 1.125rem; /* text-lg */
            text-align: center;
        }
        .section-selector button.active {
            background-color: #3B82F6; /* blue-500 */
            color: #FFFFFF;
            font-weight: 700;
        }
        /* Custom Radio Button Stilleri */
        .radio-group {
            display: flex;
            flex-wrap: nowrap; /* Metinlerin kaymasÄ±nÄ± engeller */
            gap: 0.5rem;
            justify-content: flex-start; /* Mobil iÃ§in sola hizalÄ± */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .radio-group {
                justify-content: flex-end;
            }
        }
        .radio-label {
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 9999px; /* rounded-full */
            border: 1px solid #4A5568; /* gray-600 */
            background-color: #2D3748; /* gray-800 */
            color: #A0AEC0; /* gray-400 */
            font-size: 0.75rem;
            transition: all 0.2s ease-in-out;
            text-align: center;
            white-space: normal; /* Metinlerin birden fazla satÄ±ra yayÄ±lmasÄ±na izin verir */
        }
        .radio-label:hover {
            background-color: #4A5568; /* gray-600 */
            color: #FFFFFF;
        }
        .radio-input {
            display: none;
        }
        .radio-input:checked + .radio-label {
            color: #FFFFFF;
            font-weight: 600;
            border-color: transparent;
        }
        /* Renkler */
        .radio-input[value="0"]:checked + .radio-label { background-color: #718096; } /* gray-500 */
        .radio-input[value="20"]:checked + .radio-label { background-color: #C53030; } /* red-700 */
        .radio-input[value="40"]:checked + .radio-label { background-color: #DD6B20; } /* orange-600 */
        .radio-input[value="60"]:checked + .radio-label { background-color: #D69E2E; } /* yellow-500 */
        .radio-input[value="80"]:checked + .radio-label { background-color: #38A169; } /* green-600 */
        .radio-input[value="100"]:checked + .radio-label { background-color: #3182CE; } /* blue-600 */

        /* Hide default calendar icon for date input */
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0;
            width: 100%; /* Make it fill the input to be clickable */
            height: 100%;
            cursor: pointer;
            position: absolute; /* Position over the input */
            top: 0;
            left: 0;
        }
        input[type="date"] {
            position: relative; /* Ensure it's positioned for the indicator */
            padding-right: 2.5rem; /* Make space for the custom icon */
        }
        .date-input-wrapper {
            position: relative;
        }
        .calendar-button {
            position: absolute;
            right: 0.5rem; /* Adjust as needed */
            top: 50%;
            transform: translateY(-50%);
            background-color: white; /* White background for the button */
            border: none;
            padding: 0.3rem 0.5rem;
            border-radius: 0.375rem; /* rounded-md */
            cursor: pointer;
            font-size: 1.25rem; /* Adjust emoji size */
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            height: calc(100% - 0.5rem); /* Adjust height to fit input */
            margin-right: 0.25rem; /* Small margin from the right edge */
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400">GeliÅŸmiÅŸ Teknoloji HazÄ±rlÄ±k Seviyesi (TRL) AracÄ±</h1>
            <p class="text-gray-400 mt-2">Kriter bazlÄ± dinamik puanlama ve seviye tespiti.</p>
        </header>

        <!-- BÃ¶lÃ¼m SeÃ§ici -->
        <div id="section-selector" class="flex justify-center mb-8 bg-gray-800 p-1 rounded-lg w-full max-w-md mx-auto section-selector">
            <button id="btn-engineering" class="w-1/2 px-4 py-2 rounded-md font-semibold transition-colors duration-300 active">Genel MÃ¼hendislik</button>
            <button id="btn-software" class="w-1/2 px-4 py-2 rounded-md font-semibold transition-colors duration-300">YazÄ±lÄ±m</button>
        </div>

        <!-- Proje Bilgileri -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700">
            <h2 class="text-lg font-semibold text-gray-400 mb-4">Proje Bilgileri</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="project-name" class="block text-sm font-medium text-gray-300 mb-1">Proje AdÄ±</label>
                    <input type="text" id="project-name" class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="project-manager" class="block text-sm font-medium text-gray-300 mb-1">Proje Sorumlusu</label>
                    <input type="text" id="project-manager" class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="project-type" class="block text-sm font-medium text-gray-300 mb-1">Proje TÃ¼rÃ¼</label>
                    <input type="text" id="project-type" class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="project-date" class="block text-sm font-medium text-gray-300 mb-1">Tarih</label>
                    <div class="date-input-wrapper w-full">
                        <input type="date" id="project-date" class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                        <button type="button" id="calendar-button" class="calendar-button">ðŸ“…</button>
                    </div>
                </div>
            </div>
            <div class="flex flex-col md:flex-row gap-4 mt-6">
                <button id="export-excel-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-300 shadow-md text-lg">
                    Veriyi Excel'e Aktar
                </button>
                <!-- TRL Ä°lerleme Ã–nerileri Al butonu kaldÄ±rÄ±ldÄ± -->
            </div>
        </div>

        <!-- SonuÃ§ AlanÄ± -->
        <div id="result-section" class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8 sticky top-4 z-10 border border-gray-700">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="text-center md:text-left">
                    <h2 class="text-lg font-semibold text-gray-400">Hesaplanan Teknoloji HazÄ±rlÄ±k Seviyesi</h2>
                    <p id="trl-level-text" class="text-5xl font-extrabold text-white">TRL 0</p>
                    <p id="trl-title-text" class="text-cyan-400 mt-1 text-lg">DeÄŸerlendirme iÃ§in kriterleri puanlayÄ±n.</p>
                </div>
                <div class="w-full md:w-1/2">
                    <div class="w-full bg-gray-700 rounded-full h-4">
                        <div id="progress-bar" class="bg-cyan-600 h-4 rounded-full progress-bar-inner" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TRL Ä°lerleme Ã–nerileri AlanÄ± (Gemini API) kaldÄ±rÄ±ldÄ± -->
        <!-- <div id="suggestions-section" class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700 hidden">
            <h2 class="text-lg font-semibold text-gray-400 mb-4">âœ¨ TRL Ä°lerleme Ã–nerileri</h2>
            <div id="suggestions-loading" class="text-center text-gray-500">
                <p>Ã–neriler yÃ¼kleniyor... LÃ¼tfen bekleyin.</p>
            </div>
            <div id="suggestions-content" class="min-h-[100px] text-gray-300 whitespace-pre-wrap">
                
            </div>
        </div> -->

        <!-- Kriterler Formu -->
        <div id="trl-form" class="space-y-6">
            <!-- TRL seviyeleri buraya dinamik olarak eklenecek -->
        </div>

    </div>

    <script>
        // --- VERÄ° SETLERÄ° ---
        const engineeringTrlData = [
            { level: 1, title: "Temel ilkeler gÃ¶zlemlenmiÅŸ ve raporlanmÄ±ÅŸ", criteria: [ { id: "THS1-1", text: "Yeni malzeme ya da teknolojinin temel karakteristikleri tanÄ±mlandÄ± mÄ±?" }, { id: "THS1-2", text: "MÃ¼hendislik ekibinde gÃ¶rev alan ilgili teknoloji uzmanlarÄ± teknoloji hakkÄ±nda bilgilendirilip teknolojinin saÄŸlayacaÄŸÄ± fayda ve riskler anlaÅŸÄ±ldÄ± mÄ±?" }, { id: "THS1-3", text: "Benzer teknolojiler, yeni mÃ¼hendislik yetenekleri, yÃ¶ntemleri ve araÃ§larÄ±nÄ±n geliÅŸtirilmesine olanak saÄŸlandÄ± mÄ±?" }, { id: "THS1-4", text: "Teknolojinin geliÅŸtirilme ve Ã¶lÃ§eklenme sÃ¼resince riskler tanÄ±mlandÄ± mÄ±?" }, { id: "THS1-5", text: "Teknoloji Ã§alÄ±ÅŸmasÄ±nÄ± tetikleyen gereksinimler tanÄ±mlandÄ± mÄ±?" } ] },
            { level: 2, title: "Teknoloji kavramÄ± ve / veya uygulamasÄ± formÃ¼le edilmiÅŸ", criteria: [ { id: "THS2-1", text: "Teknolojinin kullanÄ±m alanlarÄ±ndaki rekabetÃ§ilerine (yeni yetkinlikler, metot, araÃ§ vb.) ve tedarik zincirine etkisinin Ã¶n deÄŸerlendirmesi yapÄ±ldÄ± mÄ±?" }, { id: "THS2-2", text: "Potansiyel uygulamalar tanÄ±mlandÄ± mÄ±?" }, { id: "THS2-3", text: "Ã–n performans tahminleri yapÄ±ldÄ± mÄ±?" }, { id: "THS2-4", text: "Ã–n analitik Ã§alÄ±ÅŸmalar temel kavramÄ± doÄŸruladÄ± mÄ±?" } ] },
            { level: 3, title: "KavramÄ±n analitik ve deneysel olarak kritik iÅŸlev ve / veya karakteristik (ayÄ±rt edici Ã¶zellik) olarak ispatlanmasÄ±", criteria: [ { id: "THS3-1", text: "Kavram/uygulamanÄ±n kritik fonksiyonlarÄ±/bileÅŸenleri belirlendi mÄ±?" }, { id: "THS3-2", text: "Anahtar parametreler iÃ§in Ã¶n performans metrikleri saptandÄ± mÄ±?" }, { id: "THS3-3", text: "Malzeme ve sÃ¼recin Ã¼rÃ¼ne ve endÃ¼striyel ortama entegrasyonunun Ã¶n deÄŸerlendirmesi yapÄ±ldÄ± mÄ±?" }, { id: "THS3-4", text: "Teknolojik Ã¼rÃ¼nÃ¼n entegre edeceÄŸi Ã¼rÃ¼n Grubuâ€™nun uyumu saÄŸlandÄ± mÄ±?" } ] },
            { level: 4, title: "DÃ¼ÅŸÃ¼k sadakatli bileÅŸen veya deney modelinin temel fonksiyonlarÄ± laboratuvar ortamÄ±nda geÃ§erli kÄ±lÄ±nmasÄ±", criteria: [ { id: "THS4-1", text: "Kavram / uygulama, detaylÄ± sistem / alt sistem / bileÅŸen seviyesinde deney platformu tasarÄ±mÄ±na Ã§evrildi mi?" }, { id: "THS4-2", text: "Modelleme ve simÃ¼lasyon ile laboratuvar test Ã¶lÃ§Ã¼sÃ¼ performans tahminleri deÄŸerlendirildi mi?" }, { id: "THS4-3", text: "Laboratuvar testleri iÃ§in performans metrikleri oluÅŸturuldu mu? Ä°lgili test ortamÄ± tanÄ±mlandÄ± mÄ±?" } ] },
            { level: 5, title: "Orta sadakatli bileÅŸen veya deney modelinin elveriÅŸli edilen iÅŸletim ortamÄ±nda doÄŸrulanmÄ±ÅŸ", criteria: [ { id: "THS5-1", text: "Sistem arayÃ¼z gereksinimleri belirlendi mi?" }, { id: "THS5-2", text: "Daha sonraki geliÅŸtirme fazlarÄ± iÃ§in sistem seviyesi performans tahminleri yapÄ±ldÄ± mÄ±?" }, { id: "THS5-3", text: "Orta sadakat seviyesindeki deney modelinin gÃ¶sterimi yapÄ±ldÄ± mÄ±?" }, { id: "THS5-4", text: "BoyutlandÄ±rÄ±lamayan, lineer olmayan hedeflenen uygulama iÃ§in ilgili tasarÄ±m prensipleri doÄŸrulandÄ± mÄ±?" } ] },
            { level: 6, title: "Tam sistem prototipinin benzetimli iÅŸletim ortamÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±larak kritik Ã§evre koÅŸullarÄ±nda Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±n gÃ¶sterimi yapÄ±lmÄ±ÅŸ", criteria: [ { id: "THS6-1", text: "Operasyonel ortama yakÄ±n son haline getirildi mi? Kritik noktalar belirlendi mi?" }, { id: "THS6-2", text: "YÃ¼ksek sadakatli tam Ã¶lÃ§ekli prototip bÃ¼tÃ¼n kritik Ã¶lÃ§ek gereksinimlerini saÄŸlayacak ÅŸekilde imal edildi mi?" }, { id: "THS6-3", text: "Tam Ã¶lÃ§ekli prototip ilgili ortamda Ã§alÄ±ÅŸtÄ±rÄ±larak kritik Ã§evre koÅŸullarÄ±nda Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±n gÃ¶sterimi yapÄ±ldÄ± mÄ±?" } ] },
            { level: 7, title: "Sistem prototipinin gerÃ§ek operasyon ortamÄ±nda Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±n gÃ¶sterimi yapÄ±lmÄ±ÅŸ", criteria: [ { id: "THS7-1", text: "Operasyonel fizibilite gÃ¶sterimi: donatÄ±m/yazÄ±lÄ±m sistemlerinin, tÃ¼m kilit iÅŸlevlere sahip olacak ÅŸekilde entegrasyonu baÅŸarÄ±lÄ± bir ÅŸekilde yapÄ±ldÄ± mÄ±?" }, { id: "THS7-2", text: "YazÄ±lÄ±m prototipi fiziki gÃ¶sterim (demonstration) ve test iÃ§in gereken tÃ¼m kilit iÅŸlevlere sahip olacak ÅŸekilde tamamlandÄ± mÄ±?" }, { id: "THS7-3", text: "YazÄ±lÄ±m geliÅŸtirme belgeleri kÄ±smen hazÄ±rlandÄ± mÄ±?" }, { id: "THS7-4", text: "Entegre edilmiÅŸ yazÄ±lÄ±m prototipinin, gerÃ§ek (operasyonel) ortamda fiziki gÃ¶sterimi yapÄ±ldÄ± mÄ±?" } ] },
            { level: 8, title: "Son Ã¼rÃ¼nÃ¼n nihai konfigÃ¼rasyonu ile planlÄ± operasyonel sistem ve platformda baÅŸarÄ± ile Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±n gÃ¶sterimi test ve analizler ile gerÃ§ekleÅŸtirilmiÅŸ", criteria: [ { id: "THS8-1", text: "Alt sistem tasarÄ±mlarÄ± tamamlandÄ± mÄ±?" }, { id: "THS8-2", text: "TÃ¼m donanÄ±m ara yÃ¼zleri tanÄ±mlandÄ± mÄ±?" }, { id: "THS8-3", text: "Sistem tasarÄ±mÄ± tamamlandÄ± mÄ±?" }, { id: "THS8-4", text: "Nihai Ã¼rÃ¼ne entegre edilecek bileÅŸen / alt sistem / sistem donanÄ±mlarÄ±nÄ±n kabul testleri tamamlandÄ± mÄ±?" } ] },
            { level: 9, title: "Son Ã¼rÃ¼n gÃ¶reve baÅŸlamÄ±ÅŸ/tamamlanmÄ±ÅŸ", criteria: [ { id: "THS9-1", text: "Son Ã¼rÃ¼n operasyonel olarak ispatlandÄ± mÄ±?" }, { id: "THS9-2", text: "Son Ã¼rÃ¼nÃ¼n performansÄ±nÄ±n, operasyonel gereksinimleri karÅŸÄ±ladÄ±ÄŸÄ± doÄŸrulandÄ± mÄ±?" }, { id: "THS9-3", text: "Operasyonel gereksinimlerin karÅŸÄ±landÄ±ÄŸÄ±nÄ± gÃ¶steren doÄŸrulama kayÄ±tlarÄ± dokÃ¼mante edildi mi?" } ] }
        ];
        const softwareTrlData = [
            { level: 1, title: "Temel Bilimsel AraÅŸtÄ±rmalar: YazÄ±lÄ±m Ã¼rÃ¼nÃ¼nÃ¼n matematiksel formÃ¼lasyonlarÄ± ve temel Ã¶zelliklerine iliÅŸkin bilimsel bilginin geliÅŸtirildiÄŸi aÅŸamadÄ±r.", criteria: [
                { id: "THS1-1", text: "YazÄ±lÄ±m gereksinimleri genel hatlarÄ±yla tamamlandÄ± mÄ±?" },
                { id: "THS1-2", text: "Hedeflenen yazÄ±lÄ±m Ã¼rÃ¼nÃ¼nÃ¼n temel Ã¶zellikleri, matematiksel formÃ¼lasyonu ve genel algoritmasÄ±nÄ± destekleyen yayÄ±nlar, bilimsel bilgiler elde edildi mi?" },
                { id: "THS1-3", text: "Destekleyici/sÄ±nayÄ±cÄ± temel prensipler, bilimsel kurallar ve varsayÄ±mlar gÃ¶zlemlendi ve doÄŸrulandÄ± mÄ±?" },
                { id: "THS1-4", text: "GÃ¶zlem ve doÄŸrulama/sÄ±nama araÅŸtÄ±rmalarÄ± sonucunda yazÄ±lÄ±m mimarisine iliÅŸkin bilimsel bilgi geliÅŸtirildi mÄ±?" }
            ] },
            { level: 2, title: "YazÄ±lÄ±m Konsepti: TasarÄ±m: YazÄ±lÄ±m konseptinin, temel Ã¶zelliklerinin ve modelleriyle potansiyel uygulama/alanlarÄ±nÄ±n formÃ¼le edildiÄŸi aÅŸamadÄ±r.", criteria: [
                { id: "THS2-1", text: "Hedeflenen yazÄ±lÄ±mÄ±n potansiyel uygulanabilirliÄŸi belirlendi mÄ±?" },
                { id: "THS2-2", text: "Potansiyel uygulama alanlarÄ±nÄ±n yapÄ±labilirliÄŸi (fizibilitesi) doÄŸrulandÄ± mÄ±?" },
                { id: "THS2-3", text: "AlgoritmalarÄ±n ve yazÄ±lÄ±m konseptinin temel Ã¶zellikleri tanÄ±mlandÄ± mÄ±?" },
                { id: "THS2-4", text: "YazÄ±lÄ±mÄ±n Ã¼zerinde Ã§alÄ±ÅŸacaÄŸÄ± donanÄ±m halihazÄ±rda mevcut mu?" }
            ] },
            { level: 3, title: "YazÄ±lÄ±mÄ±n kritik performans Ã¶zelliklerinin doÄŸrulanmasÄ± amacÄ±yla, entegre edilmemiÅŸ yazÄ±lÄ±m bileÅŸenleri kullanÄ±larak, kritik iÅŸlevselliÄŸin (limited functionality) geliÅŸtirildiÄŸi aÅŸamasÄ±dÄ±r.", criteria: [
                { id: "THS3-1", text: "YazÄ±lÄ±mÄ±n performans ve etkileÅŸim gereksinim algoritmalarÄ± analitik Ã§alÄ±ÅŸmalarla doÄŸrulandÄ± mÄ±?" },
                { id: "THS3-2", text: "YazÄ±lÄ±ma iliÅŸkin algoritmalarÄ±n ana hatlarÄ± dokÃ¼mante edildi mÄ±?" },
                { id: "THS3-3", text: "Ä°lk yazÄ±lÄ±m kodlamalarÄ±, yazÄ±lÄ±mÄ±n operasyonel gereksinimlerini karÅŸÄ±lar doÄŸrulandÄ± mÄ±?" },
                { id: "THS3-4", text: "Destekleyici/sÄ±nayÄ±cÄ± temel prensipler, bilimsel kurallar ve varsayÄ±mlar gÃ¶zlemlendi ve doÄŸrulandÄ± mÄ±? (Test-Harness)" }
            ] },
            { level: 4, title: "YazÄ±lÄ±mÄ±n kritik bileÅŸenlerinin entegre edildiÄŸi, fonksiyonellik bakÄ±mÄ±ndan doÄŸrulandÄ±ÄŸÄ±, birarada Ã§alÄ±ÅŸabilirliÄŸinin (interoperability) ve sistem mimarisinin geliÅŸtirilmeye baÅŸlandÄ±ÄŸÄ± aÅŸamadÄ±r.", criteria: [
                { id: "THS4-1", text: "Veri formatlarÄ±nÄ±n analizi saÄŸlanarak, her bir modÃ¼lÃ¼n yazÄ±lÄ±m mimari modeliyle uyumluluÄŸu saÄŸlandÄ± mÄ±?" },
                { id: "THS4-2", text: "YazÄ±lÄ±m, yapay tam Ã¶lÃ§ek problemleri Ã§Ã¶zÃ¼mlÃ¼yor veya temsili veri setlerini tam olarak iÅŸleyebiliyor mÄ±?" },
                { id: "THS4-3", text: "TÃ¼m iÅŸlevlerin veya modÃ¼llerin geÃ§ici entegrasyonunun laboratuvar ortamÄ±nda fiziki gÃ¶sterimi yapÄ±ldÄ± mÄ±?" },
                { id: "THS4-4", text: "Entegre edilen iÅŸlevlerin veya modÃ¼llerin fonksiyonel olarak doÄŸrulamasÄ± yapÄ±ldÄ± mÄ±?" },
                { id: "THS4-5", text: "YazÄ±lÄ±m mimari modelinin birlikte Ã§alÄ±ÅŸabilirlik(interoperability), Ã¶lÃ§eklenebilirlik(scalability) ve gÃ¶zden geÃ§irilebilirlik(reviewability) konularÄ±nÄ± test ederek geliÅŸtirilmesine baÅŸlandÄ± mÄ±?" }
            ] },
            { level: 5, title: "SimÃ¼le edilmiÅŸ (benzetimli) ortamda, uÃ§tan uca yazÄ±lÄ±m unsurlarÄ±nÄ±n (iÅŸlevler/modÃ¼ller) entegre edildiÄŸi, arayÃ¼zlerin geliÅŸtirildiÄŸi ve fiziki gÃ¶steriminin yapÄ±ldÄ±ÄŸÄ± aÅŸamadÄ±r.", criteria: [
                { id: "THS5-1", text: "Her bir iÅŸlevin/modÃ¼lÃ¼n kodlamasÄ± ve hata ayÄ±klamasÄ± tamamlandÄ± mÄ±?" },
                { id: "THS5-2", text: "Ä°ÅŸlevlerin/modÃ¼llerin simÃ¼le edilmiÅŸ ortamda uyumlu mevcut sistemler/simÃ¼lasyonlar ile arayÃ¼zleri geliÅŸtirildi mi?" },
                { id: "THS5-3", text: "Ä°ÅŸlevlerin/modÃ¼llerin simÃ¼le edilmiÅŸ ortamda entegrasyonunun fiziki gÃ¶sterimi yapÄ±ldÄ± mÄ±?" },
                { id: "THS5-4", text: "YazÄ±lÄ±m mimarisi, veritabanÄ± ve arayÃ¼zleri tasarÄ±sÄ± tamamlandÄ± mÄ±?" }
            ] },
            { level: 6, title: "Prototip geliÅŸtirme tamamlandÄ±, tam Ã¶lÃ§ekteki gerÃ§ekÃ§i problemler ile test edildiÄŸi ve fiziki gÃ¶steriminin yapÄ±ldÄ±ÄŸÄ± aÅŸamadÄ±r. (YazÄ±lÄ±mÄ±n Ã¶n versiyonu)", criteria: [
                { id: "THS6-1", text: "YazÄ±lÄ±mÄ±n geliÅŸtirme ve test belgeleri dokÃ¼mante edildi mi?" },
                { id: "THS6-2", text: "YazÄ±lÄ±m algoritmasÄ±nÄ±n (theoric) gÃ¶revini tam sistem ile entegre edildi mi?" },
                { id: "THS6-3", text: "YazÄ±lÄ±m geliÅŸtirme belgeleri(kurulum, belgeleme, bakÄ±m belgeleri, eÄŸitim belgeleri) hazÄ±rlanmaya baÅŸlandÄ± mÄ±?" },
                { id: "THS6-4", text: "Zamanlama kÄ±sÄ±tlarÄ±nÄ±n (timing constraints) ve yazÄ±lÄ±m prototipinin mÃ¼hendislik fizibilite analizi tamamlanarak fiziki gÃ¶sterimi yapÄ±ldÄ± mÄ±? (Demonstration)" }
            ] },
            { level: 7, title: "GerÃ§ek (Operasyonel) ortamda prototipin fiziki gÃ¶sterimi: YazÄ±lÄ±m prototipinde gerÃ§ek ortamda tÃ¼m fonksiyonlarÄ±n fiziki gÃ¶steriminin yapÄ±ldÄ±ÄŸÄ± aÅŸamadÄ±r. (YazÄ±lÄ±mÄ±n Ã§alÄ±ÅŸÄ±r versiyonu)", criteria: [
                { id: "THS7-1", text: "Operasyonel fizibilite gÃ¶sterimi: donatÄ±m/yazÄ±lÄ±m sistemlerinin, tÃ¼m kilit iÅŸlevlere sahip olacak ÅŸekilde entegrasyonu baÅŸarÄ±lÄ± bir ÅŸekilde yapÄ±ldÄ± mÄ±?" },
                { id: "THS7-2", text: "YazÄ±lÄ±m prototipi fiziki gÃ¶sterim (demonstration) ve test iÃ§in gereken tÃ¼m kilit iÅŸlevlere sahip olacak ÅŸekilde tamamlandÄ± mÄ±?" },
                { id: "THS7-3", text: "YazÄ±lÄ±m geliÅŸtirme belgeleri kÄ±smen hazÄ±rlandÄ± mÄ±?" },
                { id: "THS7-4", text: "Entegre edilmiÅŸ yazÄ±lÄ±m prototipinin, gerÃ§ek (operasyonel) ortamda fiziki gÃ¶sterimi yapÄ±ldÄ± mÄ±?" }
            ] },
            { level: 8, title: "GerÃ§ek ortamda yazÄ±lÄ±m performans deÄŸerlendirmeleri ve belgelendirilmesi: YazÄ±lÄ±mÄ±n geliÅŸtirme sÃ¼recinin tamamlandÄ±ÄŸÄ±, operasyonel olarak ve son kullanÄ±cÄ±ya beklenen koÅŸullar altÄ±nda Ã§alÄ±ÅŸÄ±r durumda olduÄŸu aÅŸamadÄ±r. (YazÄ±lÄ±mÄ±n ilk versiyonu- v 1.0)", criteria: [
                { id: "THS8-1", text: "YazÄ±lÄ±m teknolojisi operasyonel donanÄ±m ve yazÄ±lÄ±m sistemiyle tam olarak entegre edildi mÄ±?" },
                { id: "THS8-2", text: "YazÄ±lÄ±m hatalamasÄ± tamamlandÄ± mÄ±?" },
                { id: "THS8-3", text: "YazÄ±lÄ±m geliÅŸtirme ve belgeleri tamamlandÄ± mÄ±?" },
                { id: "THS8-4", text: "YazÄ±lÄ±mÄ±n tÃ¼m iÅŸlevlerinin, simÃ¼le edilmiÅŸ operasyonel senaryolarda baÅŸarÄ±lÄ± bir ÅŸekilde fiziki gÃ¶sterimi yapÄ±ldÄ± mÄ±?" },
                { id: "THS8-5", text: "Teknoloji ve yazÄ±lÄ±m â€œGerÃ§ekleme ve DoÄŸrulamaâ€ (Verification and Validation) tamamlandÄ± mÄ±?" }
            ] },
            { level: 9, title: "GerÃ§ek Ortamda BaÅŸarÄ± ile Performans GÃ¶steren Teknoloji/Sistem: GeliÅŸtirilen teknoloji/sistemin gerÃ§ek ortamÄ±nda Ã§alÄ±ÅŸÄ±r durumda olduÄŸunun kanÄ±tlandÄ±ÄŸÄ± aÅŸamadÄ±r.", criteria: [
                { id: "THS9-1", text: "YazÄ±lÄ±m teknolojisi gerÃ§ek ortamda ve gerÃ§ek senaryolarda donanÄ±m ve yazÄ±lÄ±m sistemleriyle birlikte Ã§alÄ±ÅŸÄ±r durumda mÄ±?" },
                { id: "THS9-2", text: "YazÄ±lÄ±m teknolojisi gerÃ§ek ortamda hazÄ±rda,tekrar edilebilir ve yeniden kullanÄ±labilir ÅŸekilde mi?" },
                { id: "THS9-3", text: "YazÄ±lÄ±m mÃ¼hendisliÄŸi desteÄŸi mevcut ve sÃ¼rÃ¼lebilir durumda mÄ±?" }
            ] }
        ];
        const completionOptions = [ { text: "BaÅŸlanmadÄ±", value: 0 }, { text: "Yeni BaÅŸlandÄ±", value: 20 }, { text: "Az Ä°lerleme Kaydedildi", value: 40 }, { text: "YarÄ±sÄ± TmamamlandÄ±", value: 60 }, { text: "BÃ¼yÃ¼k BÃ¶lÃ¼mÃ¼ TamamlandÄ±", value: 80 }, { text: "TamamlandÄ±", value: 100 } ];

        // --- DOM Elementleri ---
        const form = document.getElementById('trl-form');
        const levelText = document.getElementById('trl-level-text');
        const titleText = document.getElementById('trl-title-text');
        const progressBar = document.getElementById('progress-bar');
        const btnEngineering = document.getElementById('btn-engineering');
        const btnSoftware = document.getElementById('btn-software');
        const exportExcelBtn = document.getElementById('export-excel-btn');
        // const getSuggestionsBtn = document.getElementById('get-suggestions-btn'); // KaldÄ±rÄ±ldÄ±
        const projectDateInput = document.getElementById('project-date');
        const calendarButton = document.getElementById('calendar-button');
        // const suggestionsSection = document.getElementById('suggestions-section'); // KaldÄ±rÄ±ldÄ±
        // const suggestionsLoading = document.getElementById('suggestions-loading'); // KaldÄ±rÄ±ldÄ±
        // const suggestionsContent = document.getElementById('suggestions-content'); // KaldÄ±rÄ±ldÄ±


        let currentData = engineeringTrlData;

        // --- FONKSÄ°YONLAR ---

        function renderSection(data) {
            currentData = data;
            form.innerHTML = ''; // Formu temizle

            data.forEach((levelData) => {
                const section = document.createElement('div');
                section.className = 'bg-gray-800 p-4 md:p-6 rounded-lg border border-gray-700';
                
                // BaÅŸlÄ±k ve Seviye PuanÄ± AlanÄ±
                section.innerHTML = `
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                        <div class="md:w-2/3">
                            <h3 class="text-xl font-bold text-cyan-500">TRL ${levelData.level}: ${levelData.title}</h3>
                        </div>
                        <div class="w-full md:w-1/3 mt-2 md:mt-0 text-right">
                             <div class="flex items-center gap-2 justify-end">
                                 <span id="score-${levelData.level}" class="text-lg font-bold">0%</span>
                                 <div class="w-full bg-gray-700 rounded-full h-2.5">
                                     <div id="progress-${levelData.level}" class="bg-blue-600 h-2.5 rounded-full progress-bar-inner" style="width: 0%"></div>
                                 </div>
                             </div>
                        </div>
                    </div>
                `;

                const criteriaContainer = document.createElement('div');
                criteriaContainer.className = 'space-y-4';

                levelData.criteria.forEach((criterion) => {
                    const criterionRow = document.createElement('div');
                    // GeliÅŸtirilmiÅŸ grid yapÄ±sÄ± ile hizalama sorunu Ã§Ã¶zÃ¼ldÃ¼
                    criterionRow.className = 'grid grid-cols-1 md:grid-cols-12 gap-x-4 gap-y-2 items-center border-t border-gray-700 pt-4';

                    const criterionText = document.createElement('p');
                    criterionText.className = 'text-gray-300 text-sm md:col-span-7'; // Metin alanÄ± daha geniÅŸ
                    criterionText.innerHTML = `<span class="font-semibold text-gray-100">${criterion.id}:</span> ${criterion.text}`;
                    
                    const radioGroup = document.createElement('div');
                    radioGroup.className = 'radio-group md:col-span-5'; // Buton grubu
                    radioGroup.dataset.level = levelData.level;

                    completionOptions.forEach(option => {
                        const radioId = `${criterion.id}-${option.value}`;
                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        radioInput.id = radioId;
                        radioInput.name = criterion.id;
                        radioInput.value = option.value;
                        radioInput.className = 'radio-input';
                        radioInput.addEventListener('change', calculateTRL);
                        
                        if(option.value === 0) radioInput.checked = true;

                        const radioLabel = document.createElement('label');
                        radioLabel.htmlFor = radioId;
                        radioLabel.className = 'radio-label';
                        radioLabel.textContent = option.text;

                        radioGroup.appendChild(radioInput);
                        radioGroup.appendChild(radioLabel);
                    });

                    criterionRow.appendChild(criterionText);
                    criterionRow.appendChild(radioGroup);
                    criteriaContainer.appendChild(criterionRow);
                });

                section.appendChild(criteriaContainer);
                form.appendChild(section);
            });
            calculateTRL(); // Yeni bÃ¶lÃ¼m render edildikten sonra hesaplama yap
        }

        function calculateTRL() {
            let finalTRL = 0;
            let allPreviousLevelsPassed = true;

            currentData.forEach(levelData => {
                let sumOfScores = 0;
                levelData.criteria.forEach(criterion => {
                    const selectedRadio = document.querySelector(`input[name='${criterion.id}']:checked`);
                    if(selectedRadio) {
                        sumOfScores += parseInt(selectedRadio.value, 10);
                    }
                });

                const averageScore = levelData.criteria.length > 0 ? (sumOfScores / levelData.criteria.length) : 0;
                
                updateLevelUI(levelData.level, averageScore);

                // Kural: >= 80
                if (allPreviousLevelsPassed && averageScore >= 80) {
                    finalTRL = levelData.level;
                } else {
                    allPreviousLevelsPassed = false;
                }
            });
            
            updateOverallUI(finalTRL);
        }

        function updateLevelUI(level, score) {
            const scoreEl = document.getElementById(`score-${level}`);
            const progressEl = document.getElementById(`progress-${level}`);
            
            if(!scoreEl || !progressEl) return;

            scoreEl.textContent = `${Math.round(score)}%`;
            progressEl.style.width = `${score}%`;

            if (score < 80) progressEl.style.backgroundColor = '#DD6B20'; // orange
            else progressEl.style.backgroundColor = '#38A169'; // green
        }

        function updateOverallUI(level) {
            levelText.textContent = `TRL ${level}`;
            
            if (level > 0) {
                titleText.textContent = currentData[level - 1].title;
            } else {
                titleText.textContent = "DeÄŸerlendirme iÃ§in kriterleri puanlayÄ±n.";
            }

            const progressPercentage = (level / currentData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        function exportToExcel() {
            const projectName = document.getElementById('project-name').value || 'N/A';
            const projectManager = document.getElementById('project-manager').value || 'N/A';
            const projectType = document.getElementById('project-type').value || 'N/A';
            const projectDate = document.getElementById('project-date').value || 'N/A';
            const currentTRLLevel = levelText.textContent; // "TRL X"
            const currentTRLTitle = titleText.textContent; // "BaÅŸlÄ±k metni"

            // Create a map for quick lookup of completion option text
            const scoreTextMap = {};
            completionOptions.forEach(option => {
                scoreTextMap[option.value] = option.text;
            });

            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws_data = [];
            const merges = []; // Array to store merge ranges

            // Add project information
            ws_data.push(["Proje AdÄ±:", projectName]);
            ws_data.push(["Proje Sorumlusu:", projectManager]);
            ws_data.push(["Proje TÃ¼rÃ¼:", projectType]);
            ws_data.push(["Tarih:", projectDate]);
            ws_data.push([]); // Empty row for separation

            // Add calculated TRL Level and Title
            ws_data.push(["Hesaplanan TRL Seviyesi:", currentTRLLevel]);
            ws_data.push(["Hesaplanan TRL BaÅŸlÄ±ÄŸÄ±:", currentTRLTitle]);
            ws_data.push([]); // Empty row for separation

            // Add header row for TRL criteria
            const headerRowIndex = ws_data.length; 
            ws_data.push([
                "TRL Seviyesi", "TRL BaÅŸlÄ±ÄŸÄ±", "Kriter ID", "Kriter Metni", "Puan", "Puan Durumu"
            ]);

            let currentRowIndex = ws_data.length; // This will be the starting row for the first TRL criteria

            // Add TRL data rows and define merges
            currentData.forEach(levelData => {
                const startRowForLevel = currentRowIndex;
                levelData.criteria.forEach(criterion => {
                    const selectedRadio = document.querySelector(`input[name='${criterion.id}']:checked`);
                    const score = selectedRadio ? parseInt(selectedRadio.value, 10) : 0;
                    const scoreText = scoreTextMap[score] || ''; // Get the text representation

                    ws_data.push([
                        `TRL ${levelData.level}`,
                        levelData.title,
                        criterion.id,
                        criterion.text,
                        score,
                        scoreText
                    ]);
                    currentRowIndex++;
                });
                const endRowForLevel = currentRowIndex - 1;

                // Add merge directives for TRL Level and TRL Title columns for this level
                if (startRowForLevel <= endRowForLevel) { // Only merge if there are criteria for this level
                    merges.push({ s: { r: startRowForLevel, c: 0 }, e: { r: endRowForLevel, c: 0 } }); // Merge TRL Seviyesi column (column A)
                    merges.push({ s: { r: startRowForLevel, c: 1 }, e: { r: endRowForLevel, c: 1 } }); // Merge TRL BaÅŸlÄ±ÄŸÄ± column (column B)
                }
            });

            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            
            // Apply merges to the worksheet
            if (merges.length > 0) {
                ws['!merges'] = merges;
            }

            // Define styles
            const headerStyle = {
                font: { bold: true, color: { rgb: "FFFFFFFF" } }, // White text
                fill: { fgColor: { rgb: "FF3B82F6" } }, // Tailwind blue-500
                alignment: { vertical: "center", horizontal: "center", wrapText: true },
                border: { // Add borders to header cells
                    top: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    bottom: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    left: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    right: { style: "thin", color: { rgb: "FFD1D5DB" } }
                }
            };

            const mergedCellStyle = {
                alignment: {
                    vertical: "center", // Middle align
                    horizontal: "center", // Center align
                    wrapText: true
                },
                fill: { fgColor: { rgb: "FF60A5FA" } }, // A lighter blue for merged cells
                font: { bold: true, color: { rgb: "FFFFFFFF" } }, // White bold text
                border: { // Add borders to merged cells
                    top: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    bottom: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    left: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    right: { style: "thin", color: { rgb: "FFD1D5DB" } }
                }
            };

            const dataCellStyle = {
                alignment: { vertical: "top", wrapText: true }, // Default alignment for data cells
                border: { // Add borders to all data cells
                    top: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    bottom: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    left: { style: "thin", color: { rgb: "FFD1D5DB" } },
                    right: { style: "thin", color: { rgb: "FFD1D5DB" } }
                }
            };

            // Apply header style
            for (let C = 0; C < ws_data[headerRowIndex].length; ++C) {
                const cellAddress = XLSX.utils.encode_cell({r: headerRowIndex, c: C});
                if (!ws[cellAddress]) ws[cellAddress] = {};
                ws[cellAddress].s = headerStyle;
            }

            // Apply styles to merged cells and all data cells
            for (let R = headerRowIndex + 1; R < ws_data.length; ++R) {
                for (let C = 0; C < ws_data[R].length; ++C) {
                    const cellAddress = XLSX.utils.encode_cell({r: R, c: C});
                    if (!ws[cellAddress]) ws[cellAddress] = {};
                    ws[cellAddress].s = dataCellStyle; // Apply default data cell style

                    // Check if this cell is the top-left of a merged range and apply specific style
                    const isMergedCell = merges.some(merge => {
                        return merge.s.r === R && merge.s.c === C;
                    });

                    if (isMergedCell) {
                        // Apply merged cell style to the top-left cell of the merge
                        ws[cellAddress].s = mergedCellStyle;
                    }
                }
            }

            // Set column widths for better readability
            const wscols = [
                {wch: 15}, // TRL Seviyesi
                {wch: 50}, // TRL BaÅŸlÄ±ÄŸÄ±
                {wch: 15}, // Kriter ID
                {wch: 80}, // Kriter Metni
                {wch: 10}, // Puan
                {wch: 20}  // Puan Durumu
            ];
            ws['!cols'] = wscols;

            XLSX.utils.book_append_sheet(wb, ws, "TRL DeÄŸerlendirme");

            // Write file
            XLSX.writeFile(wb, 'TRL_Degerlendirme.xlsx');
        }

        // --- OLAY DÄ°NLEYÄ°CÄ°LER ---
        btnEngineering.addEventListener('click', () => {
            btnEngineering.classList.add('active');
            btnSoftware.classList.remove('active');
            renderSection(engineeringTrlData);
        });

        btnSoftware.addEventListener('click', () => {
            btnSoftware.classList.add('active');
            btnEngineering.classList.remove('active');
            renderSection(softwareTrlData);
        });

        exportExcelBtn.addEventListener('click', exportToExcel);
        // getSuggestionsBtn.addEventListener('click', getSuggestions); // KaldÄ±rÄ±ldÄ±

        // Add event listener for the custom calendar button
        calendarButton.addEventListener('click', () => {
            projectDateInput.showPicker(); // Modern browsers
            // Fallback for older browsers if showPicker() is not supported,
            // though direct focus might not always open the picker.
            // projectDateInput.focus(); 
        });

        // --- BAÅžLANGIÃ‡ ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSection(engineeringTrlData); // BaÅŸlangÄ±Ã§ta mÃ¼hendislik bÃ¶lÃ¼mÃ¼nÃ¼ yÃ¼kle
        });
    </script>
</body>
</html>
